b <- matrix(ncol = 6, nrow = 6)
for (m in 1){
for (n in 1:6){
for (i in 1:6){
a[n,i] <- sum(ifelse(x$p_value_likelihood[x$method == meth[m] & x$effect_treatment == y10[i] & x$sd_intercept == sd_i[n]] < 0.05, 1, 0))/
length(x$p_value_likelihood[x$method == meth[m] & x$effect_treatment == y10[i] & x$sd_intercept == sd_i[n]])
}
}
}
for (m in 2){
for (n in 1:6){
for (i in 1:6){
b[n,i] <- sum(ifelse(x$p_value_likelihood[x$method == meth[m] & x$effect_treatment == y10[i] & x$sd_intercept == sd_i[n]] < 0.05, 1, 0))/
length(x$p_value_likelihood[x$method == meth[m] & x$effect_treatment == y10[i] & x$sd_intercept == sd_i[n]])
}
}
}
power <- rbind(a, b)
sd_i2 <- sd_i^2
icc <- sd_i2 / (sd_i2 + 25)
icc <- rep(icc, each = 6, times = 2)
eff <- rep(y10, times = 12)
methods <- rep(meth, each = 36)
pwr <- c()
for (i in 1: 12){
pwr <- append(pwr, power[i,])
}
power_matrix <- matrix(c(pwr, eff, round(icc, digits = 2), methods), ncol = 4, nrow = 72)
power_dataframe <- data.frame(power_matrix)
power_dataframe[,1] <- as.numeric(as.character(power_dataframe[,1]))
colnames(power_dataframe) <- c("power", "effectsize_treatment", "theoretical_icc", "method")
ggplot(data = power_dataframe, mapping = aes(x = theoretical_icc , y = power, group = method)) +
geom_line(aes(color = method)) +
labs(title = "Veränderung von Power / Typ-1 Fehler in versch. Einflussstärken eines Treatments") +
facet_wrap(~ effectsize_treatment)
}
ok <- simulation_study()
ok <- simulation_study()
ggplot(data = ok, mapping = aes(y = SE_beta_treatment, x = method)) +
geom_boxplot()
ggplot(data = ok, mapping = aes(y = SE_beta_treatment, x = method)) +
geom_boxplot()
View(ok)
ok <- simulation_study(niter = 1)
View(ok)
a <- one_simulation()
a
one_simulation <- function(n = 15000, nklassen = 300, sd_intercept = 2, sd_slope = 2,
corr = 0, sd_error = 5, y00 = 15, y10 = 0.35){
# loading dgp function
source("dgp_multi_ml.R")
# generating one data set
ml_data <- gen_ml_data(n = n, nklassen = nklassen, sd_intercept = sd_intercept,
sd_slope = sd_slope,
corr = corr, sd_error = sd_error, y00 = y00, y10 = y10)
# calculating model
lm_model_0 <- lm(leistung ~ 1, data = ml_data)
lm_model <- lm(leistung ~  uebung * klasse, data = ml_data)
mlm_model_0 <- lmer(leistung ~ 1 + (1 | klasse), data = ml_data, REML = FALSE)
mlm_I_model <- lmer(leistung ~ uebung +
(1 | klasse), data = ml_data, REML = FALSE)
mlm_IS_model <- lmer(leistung ~ uebung +
(uebung | klasse), data = ml_data)
# saving coefficients
empirical_icc <- VarCorr(mlm_model_0)$klasse[1,1] / (VarCorr(mlm_model_0)$klasse[1,1]
+ sigma(mlm_model_0)^2)
theoretical_icc <- var(ml_data$random_intercept) / var(ml_data$leistung)
beta_lm <- coef(lm_model)
SE_lm <- coef(summary(lm_model))[,2]
p_lm <- coef(summary(lm_model))[,4]
lq_lm <- anova(lm_model_0, lm_model, test = "LRT")
p_lq_lm <- lq_lm$`Pr(>Chi)`[2]
beta_I_mlm <- fixef(mlm_I_model)
SE_I_mlm <- summary(mlm_I_model)$coefficient[,2]
p_I_mlm <- coef(summary(mlm_I_model))[,5]
lq_I_mlm <- anova(mlm_model_0, mlm_I_model, test = "LRT")
p_lq_I_mlm <- lq_I_mlm$`Pr(>Chisq)`[2]
beta_IS_mlm <- fixef(mlm_IS_model)
SE_IS_mlm <- summary(mlm_IS_model)$coefficient[,2]
p_IS_mlm <- coef(summary(mlm_IS_model))[,5]
lq_IS_mlm <- anova(mlm_I_model, mlm_IS_model, test = "LRT")
p_lq_IS_mlm <- lq_IS_mlm$`Pr(>Chisq)`[2]
# saving all coefficients in a matrix
coefs <- matrix(c(beta_lm, SE_lm, p_lm, p_lq_lm, empirical_icc, theoretical_icc, sd_intercept, sd_error, y10, "lm",
beta_I_mlm, SE_I_mlm, p_I_mlm, p_lq_I_mlm, empirical_icc, theoretical_icc, sd_intercept, sd_error, y10, "rim",
beta_IS_mlm, SE_IS_mlm, p_IS_mlm, p_lq_IS_mlm, empirical_icc, theoretical_icc, sd_intercept, sd_error, y10,"rism"
),
ncol = 13, byrow = TRUE)
return(coefs)
}
a <- one_simulation()
a
one_simulation <- function(n = 15000, nklassen = 300, sd_intercept = 2, sd_slope = 2,
corr = 0, sd_error = 5, y00 = 15, y10 = 0.35){
# loading dgp function
source("dgp_multi_ml.R")
# generating one data set
ml_data <- gen_ml_data(n = n, nklassen = nklassen, sd_intercept = sd_intercept,
sd_slope = sd_slope,
corr = corr, sd_error = sd_error, y00 = y00, y10 = y10)
# calculating model
lm_model_0 <- lm(leistung ~ 1, data = ml_data)
lm_model <- lm(leistung ~  uebung * klasse, data = ml_data)
mlm_model_0 <- lmer(leistung ~ 1 + (1 | klasse), data = ml_data, REML = FALSE)
mlm_I_model <- lmer(leistung ~ uebung +
(1 | klasse), data = ml_data, REML = FALSE)
mlm_IS_model <- lmer(leistung ~ uebung +
(uebung | klasse), data = ml_data)
# saving coefficients
empirical_icc <- VarCorr(mlm_model_0)$klasse[1,1] / (VarCorr(mlm_model_0)$klasse[1,1]
+ sigma(mlm_model_0)^2)
theoretical_icc <- var(ml_data$random_intercept) / var(ml_data$leistung)
beta_lm <- coef(lm_model)
SE_lm <- coef(summary(lm_model))[,2]
p_lm <- coef(summary(lm_model))[,4]
lq_lm <- anova(lm_model_0, lm_model, test = "LRT")
p_lq_lm <- lq_lm$`Pr(>Chi)`[2]
beta_I_mlm <- fixef(mlm_I_model)
SE_I_mlm <- summary(mlm_I_model)$coefficient[,2]
p_I_mlm <- coef(summary(mlm_I_model))[,5]
lq_I_mlm <- anova(mlm_model_0, mlm_I_model, test = "LRT")
p_lq_I_mlm <- lq_I_mlm$`Pr(>Chisq)`[2]
beta_IS_mlm <- fixef(mlm_IS_model)
SE_IS_mlm <- summary(mlm_IS_model)$coefficient[,2]
p_IS_mlm <- coef(summary(mlm_IS_model))[,5]
lq_IS_mlm <- anova(mlm_I_model, mlm_IS_model, test = "LRT")
p_lq_IS_mlm <- lq_IS_mlm$`Pr(>Chisq)`[2]
# saving all coefficients in a matrix
coefs <- matrix(c(beta_lm, SE_lm, p_lm, p_lq_lm, empirical_icc, theoretical_icc, sd_intercept, sd_error, y10, "lm",
beta_I_mlm, SE_I_mlm, p_I_mlm, p_lq_I_mlm, empirical_icc, theoretical_icc, sd_intercept, sd_error, y10, "rim"#,
# beta_IS_mlm, SE_IS_mlm, p_IS_mlm, p_lq_IS_mlm, empirical_icc, theoretical_icc, sd_intercept, sd_error, y10,"rism"
),
ncol = 13, byrow = TRUE)
return(coefs)
}
a <- one_simulation()
a
b <- gen_ml_data()
b
lm_model_0 <- lm(leistung ~ 1, data = b)
lm_model <- lm(leistung ~  uebung * klasse, data = b)
mlm_model_0 <- lmer(leistung ~ 1 + (1 | klasse), data = b, REML = FALSE)
mlm_I_model <- lmer(leistung ~ uebung +
(1 | klasse), data = b, REML = FALSE)
mlm_IS_model <- lmer(leistung ~ uebung +
(uebung | klasse), data = b)
lm_model_0 <- lm(leistung ~ 1, data = b)
lm_model <- lm(leistung ~  uebung * klasse, data = b)
mlm_model_0 <- lmer(leistung ~ 1 + (1 | klasse), data = b, REML = FALSE)
mlm_I_model <- lmer(leistung ~ uebung +
(1 | klasse), data = b, REML = FALSE)
mlm_IS_model <- lmer(leistung ~ uebung +
(uebung | klasse), data = b, REML = FALSE)
empirical_icc <- VarCorr(mlm_model_0)$klasse[1,1] / (VarCorr(mlm_model_0)$klasse[1,1]
+ sigma(mlm_model_0)^2)
theoretical_icc <- var(ml_data$random_intercept) / var(ml_data$leistung)
beta_lm <- coef(lm_model)
SE_lm <- coef(summary(lm_model))[,2]
p_lm <- coef(summary(lm_model))[,4]
lq_lm <- anova(lm_model_0, lm_model, test = "LRT")
p_lq_lm <- lq_lm$`Pr(>Chi)`[2]
beta_I_mlm <- fixef(mlm_I_model)
SE_I_mlm <- summary(mlm_I_model)$coefficient[,2]
p_I_mlm <- coef(summary(mlm_I_model))[,5]
lq_I_mlm <- anova(mlm_model_0, mlm_I_model, test = "LRT")
p_lq_I_mlm <- lq_I_mlm$`Pr(>Chisq)`[2]
beta_IS_mlm <- fixef(mlm_IS_model)
SE_IS_mlm <- summary(mlm_IS_model)$coefficient[,2]
p_IS_mlm <- coef(summary(mlm_IS_model))[,5]
lq_IS_mlm <- anova(mlm_I_model, mlm_IS_model, test = "LRT")
p_lq_IS_mlm <- lq_IS_mlm$`Pr(>Chisq)`[2]
coefs <- matrix(c(beta_lm, SE_lm, p_lm, p_lq_lm, empirical_icc, theoretical_icc, sd_intercept, sd_error, y10, "lm",
beta_I_mlm, SE_I_mlm, p_I_mlm, p_lq_I_mlm, empirical_icc, theoretical_icc, sd_intercept, sd_error, y10, "rim",
beta_IS_mlm, SE_IS_mlm, p_IS_mlm, p_lq_IS_mlm, empirical_icc, theoretical_icc, sd_intercept, sd_error, y10,"rism"
),
ncol = 13, byrow = TRUE)
theoretical_icc <- var(ml_data$random_intercept) / var(ml_data$leistung)
empirical_icc <- VarCorr(mlm_model_0)$klasse[1,1] / (VarCorr(mlm_model_0)$klasse[1,1]
+ sigma(mlm_model_0)^2)
theoretical_icc <- var(b$random_intercept) / var(b$leistung)
coefs <- matrix(c(beta_lm, SE_lm, p_lm, p_lq_lm, empirical_icc, theoretical_icc, sd_intercept, sd_error, y10, "lm",
beta_I_mlm, SE_I_mlm, p_I_mlm, p_lq_I_mlm, empirical_icc, theoretical_icc, sd_intercept, sd_error, y10, "rim",
beta_IS_mlm, SE_IS_mlm, p_IS_mlm, p_lq_IS_mlm, empirical_icc, theoretical_icc, sd_intercept, sd_error, y10,"rism"
),
ncol = 13, byrow = TRUE)
coefs <- matrix(c(beta_lm, SE_lm, p_lm, p_lq_lm, empirical_icc, theoretical_icc, "lm",
beta_I_mlm, SE_I_mlm, p_I_mlm, p_lq_I_mlm, empirical_icc, theoretical_icc, "rim",
beta_IS_mlm, SE_IS_mlm, p_IS_mlm, p_lq_IS_mlm, empirical_icc, theoretical_icc, "rism"
),
ncol = 13, byrow = TRUE)
p_lq_IS_mlm
p_IS_mlm
lq_IS_mlm
lq_I_mlm
p_lq_I_mlm <- lq_I_mlm$`Pr(>Chisq)`[2]
p_lq_I_mlm
lq_I_mlm
p_lq_I_mlm
lq_IS_mlm
p_lq_IS_mlm
lq_IS_mlm$`Pr(>Chisq)`[2]
lq_IS_mlm$`Pr(>Chisq)`
lq_IS_mlm
p_lq_lm
lq_lm
lm_model <- lm(leistung ~  uebung, data = b)
lq_lm <- anova(lm_model_0, lm_model, test = "LRT")
p_lq_lm <- lq_lm$`Pr(>Chi)`[2]
lq_lm
lq_lm
lq_lm
lq_lm
lq_lm
lq_lm
lq_lm
coefs <- matrix(c(beta_lm, SE_lm, p_lm, p_lq_lm, empirical_icc, theoretical_icc, "lm",
beta_I_mlm, SE_I_mlm, p_I_mlm, p_lq_I_mlm, empirical_icc, theoretical_icc, "rim",
beta_IS_mlm, SE_IS_mlm, p_IS_mlm, p_lq_IS_mlm, empirical_icc, theoretical_icc, "rism"
),
ncol = 13, byrow = TRUE)
c(beta_lm, SE_lm, p_lm, p_lq_lm, empirical_icc, theoretical_icc, "lm",
)
c(beta_lm, SE_lm, p_lm, p_lq_lm, empirical_icc, theoretical_icc, "lm")
lm_model <- lm(leistung ~  uebung, data = b)
mlm_model_0 <- lmer(leistung ~ 1 + (1 | klasse), data = b, REML = FALSE)
mlm_I_model <- lmer(leistung ~ uebung +
(1 | klasse), data = b, REML = FALSE)
mlm_IS_model <- lmer(leistung ~ uebung +
(uebung | klasse), data = b, REML = FALSE)
empirical_icc <- VarCorr(mlm_model_0)$klasse[1,1] / (VarCorr(mlm_model_0)$klasse[1,1]
+ sigma(mlm_model_0)^2)
theoretical_icc <- var(b$random_intercept) / var(b$leistung)
beta_lm <- coef(lm_model)
SE_lm <- coef(summary(lm_model))[,2]
p_lm <- coef(summary(lm_model))[,4]
lq_lm <- anova(lm_model_0, lm_model, test = "LRT")
p_lq_lm <- lq_lm$`Pr(>Chi)`[2]
beta_I_mlm <- fixef(mlm_I_model)
SE_I_mlm <- summary(mlm_I_model)$coefficient[,2]
p_I_mlm <- coef(summary(mlm_I_model))[,5]
lq_I_mlm <- anova(mlm_model_0, mlm_I_model, test = "LRT")
p_lq_I_mlm <- lq_I_mlm$`Pr(>Chisq)`[2]
beta_IS_mlm <- fixef(mlm_IS_model)
SE_IS_mlm <- summary(mlm_IS_model)$coefficient[,2]
p_IS_mlm <- coef(summary(mlm_IS_model))[,5]
lq_IS_mlm <- anova(mlm_I_model, mlm_IS_model, test = "LRT")
p_lq_IS_mlm <- lq_IS_mlm$`Pr(>Chisq)`[2]
coefs <- matrix(c(beta_lm, SE_lm, p_lm, p_lq_lm, empirical_icc, theoretical_icc, "lm",
beta_I_mlm, SE_I_mlm, p_I_mlm, p_lq_I_mlm, empirical_icc, theoretical_icc, "rim",
beta_IS_mlm, SE_IS_mlm, p_IS_mlm, p_lq_IS_mlm, empirical_icc, theoretical_icc, "rism"
),
ncol = 13, byrow = TRUE)
beta_lm, SE_lm, p_lm, p_lq_lm, empirical_icc, theoretical_icc, "lm",
(beta_lm, SE_lm, p_lm, p_lq_lm, empirical_icc, theoretical_icc, "lm"
(beta_lm, SE_lm, p_lm, p_lq_lm, empirical_icc, theoretical_icc, "lm")
c(beta_lm, SE_lm, p_lm, p_lq_lm, empirical_icc, theoretical_icc, "lm")
coefs <- matrix(c(beta_lm, SE_lm, p_lm, p_lq_lm, empirical_icc, theoretical_icc, "lm",
beta_I_mlm, SE_I_mlm, p_I_mlm, p_lq_I_mlm, empirical_icc, theoretical_icc, "rim",
beta_IS_mlm, SE_IS_mlm, p_IS_mlm, p_lq_IS_mlm, empirical_icc, theoretical_icc, "rism"
),
ncol = 13, byrow = TRUE)
c(beta_IS_mlm, SE_IS_mlm, p_IS_mlm, p_lq_IS_mlm, empirical_icc, theoretical_icc, "rism")
coefs <- matrix(c(beta_lm, SE_lm, p_lm, p_lq_lm, empirical_icc, theoretical_icc, "lm",
beta_I_mlm, SE_I_mlm, p_I_mlm, p_lq_I_mlm, empirical_icc, theoretical_icc, "rim",
beta_IS_mlm, SE_IS_mlm, p_IS_mlm, p_lq_IS_mlm, empirical_icc, theoretical_icc, "rism"
),
ncol = 10, byrow = TRUE)
coefs
one_simulation <- function(n = 15000, nklassen = 300, sd_intercept = 2, sd_slope = 2,
corr = 0, sd_error = 5, y00 = 15, y10 = 0.35){
# loading dgp function
source("dgp_multi_ml.R")
# generating one data set
ml_data <- gen_ml_data(n = n, nklassen = nklassen, sd_intercept = sd_intercept,
sd_slope = sd_slope,
corr = corr, sd_error = sd_error, y00 = y00, y10 = y10)
# calculating model
lm_model_0 <- lm(leistung ~ 1, data = ml_data)
lm_model <- lm(leistung ~  uebung, data = ml_data)
mlm_model_0 <- lmer(leistung ~ 1 + (1 | klasse), data = ml_data, REML = FALSE)
mlm_I_model <- lmer(leistung ~ uebung +
(1 | klasse), data = ml_data, REML = FALSE)
mlm_IS_model <- lmer(leistung ~ uebung +
(uebung | klasse), data = ml_data, REML = FALSE)
# saving coefficients
empirical_icc <- VarCorr(mlm_model_0)$klasse[1,1] / (VarCorr(mlm_model_0)$klasse[1,1]
+ sigma(mlm_model_0)^2)
theoretical_icc <- var(ml_data$random_intercept) / var(ml_data$leistung)
beta_lm <- coef(lm_model)
SE_lm <- coef(summary(lm_model))[,2]
p_lm <- coef(summary(lm_model))[,4]
lq_lm <- anova(lm_model_0, lm_model, test = "LRT")
p_lq_lm <- lq_lm$`Pr(>Chi)`[2]
beta_I_mlm <- fixef(mlm_I_model)
SE_I_mlm <- summary(mlm_I_model)$coefficient[,2]
p_I_mlm <- coef(summary(mlm_I_model))[,5]
lq_I_mlm <- anova(mlm_model_0, mlm_I_model, test = "LRT")
p_lq_I_mlm <- lq_I_mlm$`Pr(>Chisq)`[2]
beta_IS_mlm <- fixef(mlm_IS_model)
SE_IS_mlm <- summary(mlm_IS_model)$coefficient[,2]
p_IS_mlm <- coef(summary(mlm_IS_model))[,5]
lq_IS_mlm <- anova(mlm_I_model, mlm_IS_model, test = "LRT")
p_lq_IS_mlm <- lq_IS_mlm$`Pr(>Chisq)`[2]
# saving all coefficients in a matrix
coefs <- matrix(c(beta_lm, SE_lm, p_lm, p_lq_lm, empirical_icc, theoretical_icc, sd_intercept, sd_error, y10, "lm",
beta_I_mlm, SE_I_mlm, p_I_mlm, p_lq_I_mlm, empirical_icc, theoretical_icc, sd_intercept, sd_error, y10, "rim",
beta_IS_mlm, SE_IS_mlm, p_IS_mlm, p_lq_IS_mlm, empirical_icc, theoretical_icc, sd_intercept, sd_error, y10,"rism"
),
ncol = 13, byrow = TRUE)
return(coefs)
}
gen_ml_data <- function(n = 15000, nklassen = 300, sd_intercept = 2, sd_slope = 2,
corr = 0, sd_error = 5, y00 = 15, y10 = 0.35){
# Creating Treatment as Level-1 Variable
uebung <- sample(rep(c(0:29), each = n/length(c(0:29))), n)
klasse <- rep(1:nklassen, each = n/nklassen)
# Creating Treatment as Level-2 Variable
# anz_math_lektionen <- sample(c(0:6), n, replace = TRUE)
# math_lektionen <- c()
# for (i in 1:n){
#   math_lektionen[i] <- anz_math_lektionen[klasse[i]]
# }
# Creating random effects of klassen
covar01 <- corr * sqrt(sd_intercept^2 * sd_slope^2)
effekte_cov_matrix <- matrix(c(sd_intercept^2,
covar01,
covar01,
sd_slope^2
), 2, 2)
effekte <- mvrnorm(n = nklassen, mu = c(0,0),
Sigma = effekte_cov_matrix, empirical = TRUE)
effekt_int <- effekte[,1]
effekt_slope <- effekte[,2]
# Creating random effects for Intercept and Slope based on klassen
random_intercept <- numeric(n)
for (i in 1:n){
random_intercept[i] <- effekt_int[klasse[i]]
}
random_slope <- numeric(n)
for (i in 1:n){
random_slope[i] <- effekt_slope[klasse[i]]
}
# Creating random error for individuals
error <- rnorm(n, mean = 0, sd = sd_error)
# Calculating individual leistung score
leistung <- y00 +
y10 * uebung +
random_intercept +
random_slope * uebung +
error
# Creating dataframe
klasse <- as.factor(klasse)
levels(klasse) <- paste("Kl", 1:nklassen, sep = ".")
ml_data <- data.frame(klasse, uebung, leistung, random_intercept, random_slope)
return(ml_data)
}
simulation_study <- function(n = 15000, nklassen = 300, niter = 100, sd_intercept = 2,
sd_slope = 2, corr = 0, sd_error = 5, y00 = 15, y10 = 0.35){
# loading one simulation function
source("one_simulation_ml.R")
# creating data frame for coefs
coef_models <- data.frame()
# adding coefs for n iterations
for(num in 1:length(sd_intercept)){
for(fix_eff in 1:length(y10)){
for(i in 1:niter){
coef_models <- rbind(coef_models, one_simulation(n = n, nklassen = nklassen,
sd_intercept = sd_intercept[num],
sd_slope = sd_slope, corr = corr,
sd_error = sd_error,
y00 = y00, y10 = y10[fix_eff]))
}
print(paste(fix_eff, "out of", length(y10), "fixed effects simulated"))
}
print(paste(num, "out of", length(sd_intercept), "SDs simulated"))
}
print("*** Simulation Complete ***")
# formatting data frame
colnames(coef_models) <- c("beta_0", "beta_treatment",
"SE_beta_0", "SE_beta_treatment", "p_value_0",
"p_value_treatment", "p_value_likelihood", "empirical_icc",
"theoretical_icc", "sd_intercept", "sd_error", "effect_treatment",
"method")
coef_models[,1:9] <- apply(coef_models[,1:9], 2, as.character)
coef_models[,1:9] <- apply(coef_models[,1:9], 2, as.numeric)
return(coef_models)
}
ok <- simulation_study(niter = 1)
ggplot(data = ok, mapping = aes(y = SE_beta_treatment, x = method)) +
geom_boxplot()
ok <- simulation_study(niter = 1, sd_slope = 0)
ggplot(data = ok, mapping = aes(y = SE_beta_treatment, x = method)) +
geom_boxplot()
ok <- simulation_study(niter = 100, sd_slope = 2)
ggplot(data = ok, mapping = aes(y = SE_beta_treatment, x = method)) +
geom_boxplot()
ok
View(ok)
ggplot(data = ok, mapping = aes(y = p_value_likelihood, x = method)) +
geom_boxplot()
ggplot(data = ok, mapping = aes(y = SE_beta_treatment, x = method)) +
geom_boxplot()
nok <- simulation_study(niter = 100, sd_slope = 0)
ggplot(data = nok, mapping = aes(y = SE_beta_treatment, x = method)) +
geom_boxplot()
ggplot(data = ok, mapping = aes(y = SE_beta_treatment, x = method)) +
geom_boxplot()
ggplot(data = nok, mapping = aes(y = p_value_likelihood, x = method)) +
geom_boxplot()
ggplot(data = ok, mapping = aes(y = p_value_likelihood, x = method)) +
geom_boxplot()
ggplot(data = ok, mapping = aes(y = SE_beta_treatment, x = method)) +
geom_boxplot()
ggplot(data = nok, mapping = aes(y = SE_beta_treatment, x = method)) +
geom_boxplot()
ggplot(data = ok, mapping = aes(y = SE_beta_treatment, x = method)) +
geom_boxplot()
ggplot(data = nok, mapping = aes(y = SE_beta_treatment, x = method)) +
geom_boxplot()
ggplot(data = nok, mapping = aes(y = p_value_likelihood, x = method)) +
geom_boxplot()
ggplot(data = ok, mapping = aes(y = p_value_likelihood, x = method)) +
geom_boxplot()
ggplot(data = ok, mapping = aes(y = SE_beta_treatment, x = method)) +
geom_boxplot()
ggplot(data = nok, mapping = aes(y = SE_beta_treatment, x = method)) +
geom_boxplot()
ggplot(data = ok, mapping = aes(y = p_value_likelihood, x = method)) +
geom_boxplot()
ggplot(data = nok, mapping = aes(y = p_value_likelihood, x = method)) +
geom_boxplot()
ok <- simulation_study(niter = 100, sd_slope = 2, y10 = 0)
nok <- simulation_study(niter = 100, sd_slope = 0, y10 = 0)
ggplot(data = ok, mapping = aes(y = SE_beta_treatment, x = method)) +
geom_boxplot()
ggplot(data = nok, mapping = aes(y = SE_beta_treatment, x = method)) +
geom_boxplot()
ggplot(data = ok, mapping = aes(y = p_value_likelihood, x = method)) +
geom_boxplot()
ggplot(data = nok, mapping = aes(y = p_value_likelihood, x = method)) +
geom_boxplot()
View(ok)
gen_ml_data <- function(n = 15000, nklassen = 300, sd_intercept = 2, sd_slope = 2,
corr = 0, sd_error = 5, y00 = 15, y10 = 0.35){
# Creating Treatment as Level-1 Variable
uebung <- sample(rep(c(0:29), each = n/length(c(0:29))), n)
klasse <- rep(1:nklassen, each = n/nklassen)
# Creating Treatment as Level-2 Variable
# anz_math_lektionen <- sample(c(0:6), n, replace = TRUE)
# math_lektionen <- c()
# for (i in 1:n){
#   math_lektionen[i] <- anz_math_lektionen[klasse[i]]
# }
# Creating random effects of klassen
covar01 <- corr * sqrt(sd_intercept^2 * sd_slope^2)
effekte_cov_matrix <- matrix(c(sd_intercept^2,
covar01,
covar01,
sd_slope^2
), 2, 2)
effekte <- mvrnorm(n = nklassen, mu = c(0,0),
Sigma = effekte_cov_matrix, empirical = TRUE)
effekt_int <- effekte[,1]
effekt_slope <- effekte[,2]
# Creating random effects for Intercept and Slope based on klassen
random_intercept <- numeric(n)
for (i in 1:n){
random_intercept[i] <- effekt_int[klasse[i]]
}
random_slope <- numeric(n)
for (i in 1:n){
random_slope[i] <- effekt_slope[klasse[i]]
}
# Creating random error for individuals
error <- rnorm(n, mean = 0, sd = sd_error)
# Calculating individual leistung score
leistung <- y00 +
y10 * uebung +
random_intercept +
random_slope * uebung +
error
# Creating dataframe
klasse <- as.factor(klasse)
levels(klasse) <- paste("Kl", 1:nklassen, sep = ".")
ml_data <- data.frame(klasse, uebung, leistung, random_intercept, random_slope)
return(ml_data)
}
a <- gen_ml_data()
lm0 <- lmer(leistung ~ 1 + (1 | klasse), data = a)
lm1 <- lmer(leistung ~ uebung + (1 | klasse), data = a)
lm2 <- lmer(leistung ~ uebung + (uebung | klasse), data = a)
lm3 <- lmer(leistung ~ uebung + (uebung || klasse), data = a)
anova(lm0, lm1, lm2, lm3)
b$`Pr(>Chisq)`[2]
b <- anova(lm0, lm1, lm2, lm3)
b$`Pr(>Chisq)`[2]
b$`Pr(>Chisq)`
b <- anova(lm1, lm3)
b$`Pr(>Chisq)`[2]
b$`Pr(>Chisq)`
b
View(b)
anova(lm1, lm3)
2.2e-16
anova(lm1, lm3)
2.2e-162.2e-16
2.2e-16
b <- anova(lm1, lm2)
b$`Pr(>Chisq)`[2]
b <- anova(lm1, lm2, lm3)
b$`Pr(>Chisq)`[2]
b
